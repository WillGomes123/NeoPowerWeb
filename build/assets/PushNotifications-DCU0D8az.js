import{j as e}from"./ui-vendor-D6QdPKSZ.js";import{a}from"./react-vendor-BVAhLato.js";import{f as s,t as l,z as r,B as t,A as c,I as i,U as d,M as m,C as n,d as o,a as x,b as h,g as j,k as p}from"./index-BaJa-ZGP.js";import{T as g}from"./textarea-CUg0IQnS.js";import{S as u,a as N,b as f,c as b,d as v}from"./select-DGz8aZRk.js";import{D as w,f as C,a as y,b as E,c as S,d as k}from"./dialog-BkZWeYAN.js";import{E as A,a as T,b as z,c as _,d as P,e as L}from"./EnhancedTable-DB0V6gm6.js";import{P as D}from"./plus-ZXf-gh-s.js";import{C as M,a as $}from"./circle-check-big-Be0sakXG.js";import{C as q}from"./circle-x-BaVF9_aR.js";import{S as I}from"./send-BrF-3Vq4.js";import"./charts-BaPK5s1M.js";import"./x-OVfnIpib.js";import"./table-KAkNip0H.js";const U={draft:{label:"Rascunho",color:"bg-zinc-500",icon:j},scheduled:{label:"Agendada",color:"bg-blue-500",icon:j},sending:{label:"Enviando",color:"bg-yellow-500",icon:$},sent:{label:"Enviada",color:"bg-emerald-500",icon:M},failed:{label:"Falhou",color:"bg-red-500",icon:q}},F={all_users:"Todos os Usuários",specific_location:"Local Específico",specific_users:"Usuários Específicos"},B=()=>{const[j,$]=a.useState([]),[B,R]=a.useState(null),[V,J]=a.useState([]),[O,G]=a.useState(!0),[H,K]=a.useState(!1),[Q,W]=a.useState(null),[X,Y]=a.useState(""),[Z,ee]=a.useState(""),[ae,se]=a.useState("all_users"),[le,re]=a.useState("");a.useEffect(()=>{te()},[]);const te=async()=>{G(!0);try{const[e,a,l]=await Promise.all([s.get("/push/campaigns"),s.get("/push/stats"),s.get("/locations")]);if(e.ok){const a=await e.json();$(a.campaigns||[])}if(a.ok){const e=await a.json();R(e)}if(l.ok){const e=await l.json();J(e||[])}}catch(e){l.error("Erro ao carregar dados")}finally{G(!1)}},ce=()=>{Y(""),ee(""),se("all_users"),re("")};return O?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-emerald-400",children:"Carregando..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-emerald-50 flex items-center gap-3",children:[e.jsx(r,{className:"w-8 h-8 text-emerald-400"}),"Push Notifications"]}),e.jsx("p",{className:"text-emerald-300/60 mt-1",children:"Envie notificações para usuários do aplicativo"})]}),e.jsxs(w,{open:H,onOpenChange:K,children:[e.jsx(C,{asChild:!0,children:e.jsxs(t,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Nova Campanha"]})}),e.jsxs(y,{className:"bg-gradient-to-br from-emerald-950/95 to-emerald-900/95 border-emerald-800/50 text-emerald-50 max-w-lg",children:[e.jsxs(E,{children:[e.jsxs(S,{className:"text-emerald-50 flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5 text-emerald-400"}),"Nova Campanha de Notificação"]}),e.jsx(k,{className:"text-emerald-300/60",children:"Crie uma notificação para enviar aos usuários do aplicativo"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-emerald-200",children:"Título da Notificação"}),e.jsx(i,{value:X,onChange:e=>Y(e.target.value),placeholder:"Ex: Promoção Especial!",className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50",maxLength:100}),e.jsxs("p",{className:"text-xs text-emerald-400/60",children:[X.length,"/100 caracteres"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-emerald-200",children:"Mensagem"}),e.jsx(g,{value:Z,onChange:e=>ee(e.target.value),placeholder:"Digite a mensagem da notificação...",className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 min-h-[100px]",maxLength:500}),e.jsxs("p",{className:"text-xs text-emerald-400/60",children:[Z.length,"/500 caracteres"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-emerald-200",children:"Público-Alvo"}),e.jsxs(u,{value:ae,onValueChange:se,children:[e.jsx(N,{className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50",children:e.jsx(f,{})}),e.jsxs(b,{className:"bg-emerald-900 border-emerald-700",children:[e.jsx(v,{value:"all_users",className:"text-emerald-50 focus:bg-emerald-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"}),"Todos os Usuários"]})}),e.jsx(v,{value:"specific_location",className:"text-emerald-50 focus:bg-emerald-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4"}),"Local Específico"]})})]})]})]}),"specific_location"===ae&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-emerald-200",children:"Selecione o Local"}),e.jsxs(u,{value:le,onValueChange:re,children:[e.jsx(N,{className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50",children:e.jsx(f,{placeholder:"Escolha um local"})}),e.jsx(b,{className:"bg-emerald-900 border-emerald-700",children:V.map(a=>e.jsx(v,{value:a.id.toString(),className:"text-emerald-50 focus:bg-emerald-800",children:a.nomeDoLocal},a.id))})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-zinc-900 rounded-lg border border-zinc-700",children:[e.jsx("p",{className:"text-xs text-zinc-400 mb-2",children:"Preview da Notificação:"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-600 rounded-lg flex items-center justify-center",children:e.jsx(c,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-white text-sm",children:X||"Título da Notificação"}),e.jsx("p",{className:"text-zinc-400 text-xs mt-0.5 line-clamp-2",children:Z||"Mensagem da notificação aparece aqui..."})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-emerald-800/30",children:[e.jsx(t,{variant:"outline",onClick:()=>K(!1),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 hover:bg-emerald-800/60",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{if(X.trim()&&Z.trim())try{const e={title:X.trim(),message:Z.trim(),targetAudience:ae};"specific_location"===ae&&le&&(e.locationId=parseInt(le));if(!(await s.post("/push/campaigns",e)).ok)throw new Error("Erro ao criar campanha");l.success("Campanha criada com sucesso!"),K(!1),ce(),te()}catch(e){l.error("Erro ao criar campanha")}else l.error("Preencha o título e a mensagem")},className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Criar Campanha"})]})]})]})]}),B&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center",children:e.jsx(d,{className:"w-6 h-6 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-50",children:B.activeTokens}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Dispositivos Ativos"})]})]})})}),e.jsx(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center",children:e.jsx(r,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-50",children:B.totalCampaigns}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Total de Campanhas"})]})]})})}),e.jsx(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center",children:e.jsx(M,{className:"w-6 h-6 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-50",children:B.totalSent}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Enviadas com Sucesso"})]})]})})}),e.jsx(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-50",children:B.totalFailed}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Falhas"})]})]})})})]}),e.jsxs(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:[e.jsx(x,{className:"border-b border-emerald-800/30 pb-6",children:e.jsxs(h,{className:"text-emerald-50 flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5 text-emerald-400"}),"Campanhas"]})}),e.jsx(o,{className:"pt-6",children:0===j.length?e.jsxs("div",{className:"text-center py-12 text-emerald-300/60",children:[e.jsx(r,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma campanha criada ainda"}),e.jsx("p",{className:"text-sm mt-1",children:'Clique em "Nova Campanha" para começar'})]}):e.jsxs(A,{striped:!0,hoverable:!0,children:[e.jsx(T,{children:e.jsxs(z,{hoverable:!1,children:[e.jsx(_,{children:"Título"}),e.jsx(_,{children:"Mensagem"}),e.jsx(_,{children:"Público"}),e.jsx(_,{children:"Status"}),e.jsx(_,{children:"Enviadas"}),e.jsx(_,{children:"Data"}),e.jsx(_,{children:"Ações"})]})}),e.jsx(P,{children:j.map((a,r)=>{const c=U[a.status].icon;return e.jsxs(z,{index:r,children:[e.jsx(L,{className:"font-semibold text-emerald-100",children:a.title}),e.jsx(L,{className:"text-sm text-emerald-300/70 max-w-xs truncate",children:a.message}),e.jsx(L,{className:"text-sm text-emerald-300/70",children:F[a.targetAudience]}),e.jsx(L,{children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium text-white ${U[a.status].color}`,children:[e.jsx(c,{className:"w-3 h-3"}),U[a.status].label]})}),e.jsxs(L,{className:"text-sm",children:[e.jsx("span",{className:"text-emerald-400",children:a.sentCount}),a.failedCount>0&&e.jsxs("span",{className:"text-red-400 ml-1",children:["/ ",a.failedCount," falhas"]})]}),e.jsx(L,{className:"text-sm text-emerald-300/70",children:(i=a.sentAt||a.createdAt,i?new Date(i).toLocaleString("pt-BR"):"-")}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[("draft"===a.status||"scheduled"===a.status)&&e.jsxs(t,{size:"sm",onClick:()=>(async e=>{W(e);try{const a=await s.post(`/push/campaigns/${e}/send`);if(!a.ok){const e=await a.json();throw new Error(e.error||"Erro ao enviar")}const r=await a.json();l.success(`Campanha enviada! ${r.sent} enviados, ${r.failed} falharam`),te()}catch(a){l.error(a.message||"Erro ao enviar campanha")}finally{W(null)}})(a.id),disabled:Q===a.id,className:"bg-emerald-600 hover:bg-emerald-700 text-white h-8 px-3",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),Q===a.id?"Enviando...":"Enviar"]}),e.jsx(t,{size:"sm",variant:"ghost",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir esta campanha?"))try{if(!(await s.delete(`/push/campaigns/${e}`)).ok)throw new Error("Erro ao excluir");l.success("Campanha excluída"),te()}catch(a){l.error("Erro ao excluir campanha")}})(a.id),disabled:"sending"===a.status,className:"text-red-400 hover:text-red-300 hover:bg-red-500/20 h-8 px-2",children:e.jsx(p,{className:"w-4 h-4"})})]})})]},a.id);var i})})]})})]})]})};export{B as PushNotifications,B as default};
