import{j as e}from"./ui-vendor-D6QdPKSZ.js";import{a as s}from"./react-vendor-BVAhLato.js";import{c as a,f as r,t,Z as c,C as l,a as d,b as i,d as n,g as o,M as m,B as x,R as h}from"./index-BaJa-ZGP.js";import{E as j,a as b,b as p,c as g,d as N,e as u}from"./EnhancedTable-DB0V6gm6.js";import{S as f,a as v,b as w,c as y,d as z}from"./select-DGz8aZRk.js";import{S as C}from"./StatusBadge-BNii0mfw.js";import{D as S,a as _,b as A,c as E,d as k}from"./dialog-BkZWeYAN.js";import{B as I}from"./badge-CIrDOdUW.js";import{A as D}from"./activity-7-J4c3C7.js";import{I as P,P as R}from"./power-f1zJslFI.js";import{C as $}from"./circle-check-BUKjHuaz.js";import"./charts-BaPK5s1M.js";import"./table-KAkNip0H.js";import"./x-OVfnIpib.js";
/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=a("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),F=({chargePointId:a,open:j,onOpenChange:b,onUpdate:p})=>{const[g,N]=s.useState(null),[u,C]=s.useState(!1),[$,L]=s.useState(!1),[F,M]=s.useState(!1),[O,B]=s.useState("Soft");s.useEffect(()=>{j&&a&&H()},[j,a]);const H=async()=>{if(a){C(!0);try{const e=await r.get(`/chargers/${a}/details`);if(e.ok){const s=await e.json();N(s)}else t.error("Erro ao carregar detalhes do carregador")}catch{t.error("Erro ao carregar detalhes do carregador")}finally{C(!1)}}},U=async e=>{if(a){M(!0);try{const s=await r.post(`/chargers/${a}/availability`,{type:e?"Operative":"Inoperative",connectorId:0});if(s.ok){"Accepted"===(await s.json()).status?(t.success(`Carregador ${e?"ativado":"desativado"} com sucesso`),H(),p?.()):t.warning("Comando de disponibilidade rejeitado")}else{const e=await s.json();t.error(e.error||"Erro ao alterar disponibilidade")}}catch{t.error("Erro ao alterar disponibilidade")}finally{M(!1)}}},V=e=>{switch(e?.toLowerCase()){case"available":return"bg-emerald-500/20 text-emerald-400 border-emerald-500/30";case"charging":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"preparing":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"faulted":return"bg-red-500/20 text-red-400 border-red-500/30";default:return"bg-zinc-500/20 text-zinc-400 border-zinc-500/30"}};return e.jsx(S,{open:j,onOpenChange:b,children:e.jsxs(_,{className:"bg-zinc-900 border-zinc-800 max-w-2xl",children:[e.jsxs(A,{children:[e.jsxs(E,{className:"text-white flex items-center gap-2",children:[e.jsx(c,{className:"h-5 w-5 text-emerald-500"}),"Detalhes do Carregador"]}),e.jsx(k,{className:"text-zinc-400",children:a})]}),u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"})}):g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(l,{className:"bg-zinc-800/50 border-zinc-700",children:[e.jsx(d,{className:"pb-2",children:e.jsxs(i,{className:"text-sm text-zinc-400 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Status"]})}),e.jsxs(n,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:""+(g.isConnected?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"),children:g.isConnected?"Conectado":"Desconectado"}),g.status&&e.jsx(I,{className:V(g.status),children:g.status})]}),e.jsxs("div",{className:"text-sm text-zinc-400 flex items-center gap-1",children:[e.jsx(o,{className:"h-4 w-4"}),"Último heartbeat: ",(q=g.last_heartbeat,q?new Date(q).toLocaleString("pt-BR"):"N/A")]})]})]}),e.jsxs(l,{className:"bg-zinc-800/50 border-zinc-700",children:[e.jsx(d,{className:"pb-2",children:e.jsxs(i,{className:"text-sm text-zinc-400 flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Informações do Dispositivo"]})}),e.jsx(n,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Modelo"}),e.jsx("p",{className:"text-white",children:g.model||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Fornecedor"}),e.jsx("p",{className:"text-white",children:g.vendor||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Número de Série"}),e.jsx("p",{className:"text-white font-mono text-sm",children:g.serial_number||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Firmware"}),e.jsx("p",{className:"text-white font-mono text-sm",children:g.firmware_version||"N/A"})]})]})})]}),g.connectors&&g.connectors.length>0&&e.jsxs(l,{className:"bg-zinc-800/50 border-zinc-700",children:[e.jsx(d,{className:"pb-2",children:e.jsxs(i,{className:"text-sm text-zinc-400 flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),"Conectores"]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-2",children:g.connectors.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-zinc-900/50 rounded-lg",children:[e.jsxs("span",{className:"text-zinc-300",children:["Conector ",s.id]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:V(s.status),children:s.status}),s.error_code&&"NoError"!==s.error_code&&e.jsx(I,{className:"bg-red-500/20 text-red-400",children:s.error_code})]})]},s.id))})})]}),e.jsxs(l,{className:"bg-zinc-800/50 border-zinc-700",children:[e.jsx(d,{className:"pb-2",children:e.jsxs(i,{className:"text-sm text-zinc-400 flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Ações"]})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{value:O,onValueChange:e=>B(e),children:[e.jsx(v,{className:"w-32 bg-zinc-900 border-zinc-700 text-white",children:e.jsx(w,{})}),e.jsxs(y,{className:"bg-zinc-900 border-zinc-700",children:[e.jsx(z,{value:"Soft",className:"text-white",children:"Soft Reset"}),e.jsx(z,{value:"Hard",className:"text-white",children:"Hard Reset"})]})]}),e.jsxs(x,{onClick:async()=>{if(a){L(!0);try{const e=await r.post(`/chargers/${a}/reset`,{type:O});if(e.ok){"Accepted"===(await e.json()).status?t.success(`Reset ${O} aceito pelo carregador`):t.warning(`Reset ${O} rejeitado pelo carregador`),p?.()}else{const s=await e.json();t.error(s.error||"Erro ao enviar comando de reset")}}catch{t.error("Erro ao enviar comando de reset")}finally{L(!1)}}},disabled:$||!g.isConnected,variant:"outline",className:"border-zinc-700 text-zinc-300 hover:bg-zinc-800",children:[e.jsx(h,{className:"h-4 w-4 mr-2 "+($?"animate-spin":"")}),$?"Resetando...":"Resetar"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{onClick:()=>U(!0),disabled:F||!g.isConnected,className:"bg-emerald-600 hover:bg-emerald-700",children:"Ativar"}),e.jsx(x,{onClick:()=>U(!1),disabled:F||!g.isConnected,variant:"outline",className:"border-red-700 text-red-400 hover:bg-red-900/20",children:"Desativar"}),!g.isConnected&&e.jsx("span",{className:"text-xs text-zinc-500",children:"Carregador desconectado"})]})]})]})]}):e.jsx("div",{className:"text-center py-12 text-zinc-400",children:"Carregador não encontrado"})]})});var q},M=()=>{const[a,o]=s.useState([]),[m,h]=s.useState([]),[S,_]=s.useState(!0),[A,E]=s.useState({}),[k,I]=s.useState(null),[D,P]=s.useState(!1),R=async()=>{_(!0);try{const[e,s]=await Promise.all([r.get("/chargers"),r.get("/locations")]);if(!e.ok||!s.ok)throw new Error("Erro ao buscar dados.");const a=await e.json(),t=await s.json();o(a),h(t);const c={};a.forEach(e=>{!e.locationId&&t.length>0&&(c[e.charge_point_id]=t[0].id.toString())}),E(c)}catch(e){t.error("Erro ao buscar dados")}finally{_(!1)}};s.useEffect(()=>{R()},[]);const M=a.filter(e=>!e.locationId),O=a.filter(e=>e.locationId);return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-emerald-400",children:"Carregando estações..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-emerald-50 flex items-center gap-3",children:[e.jsx(c,{className:"w-8 h-8 text-emerald-400"}),"Estações de Recarga"]}),e.jsx("p",{className:"text-emerald-300/60 mt-1",children:"Gerenciamento de carregadores"})]}),M.length>0&&e.jsxs(l,{className:"bg-gradient-to-br from-amber-950/40 to-emerald-900/20 border-amber-700/30 backdrop-blur-sm shadow-2xl shadow-amber-900/10",children:[e.jsxs(d,{className:"border-b border-amber-700/30 pb-6",children:[e.jsxs(i,{className:"text-amber-50 flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5 text-amber-400"}),"Carregadores Pendentes"]}),e.jsx("p",{className:"text-sm text-amber-300/60",children:"Associe estes carregadores a um local"})]}),e.jsx(n,{className:"pt-6",children:e.jsxs(j,{hoverable:!0,children:[e.jsx(b,{children:e.jsxs(p,{hoverable:!1,children:[e.jsx(g,{children:"Charge Point ID"}),e.jsx(g,{children:"Modelo"}),e.jsx(g,{children:"Fornecedor"}),e.jsx(g,{children:"Local"}),e.jsx(g,{children:"Ação"})]})}),e.jsx(N,{children:M.map((s,a)=>e.jsxs(p,{index:a,children:[e.jsx(u,{className:"font-mono",children:e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-500/10 border border-emerald-500/20 text-emerald-300",children:s.charge_point_id})}),e.jsx(u,{className:"font-medium",children:s.model||"N/A"}),e.jsx(u,{className:"text-sm text-emerald-300/70",children:s.vendor||"N/A"}),e.jsx(u,{children:e.jsxs(f,{value:A[s.charge_point_id]||"",onValueChange:e=>E(a=>({...a,[s.charge_point_id]:e})),children:[e.jsx(v,{className:"w-[250px] bg-emerald-900/40 border-emerald-700/50 text-emerald-50 hover:bg-emerald-800/60",children:e.jsx(w,{placeholder:"Selecione um local"})}),e.jsx(y,{className:"bg-emerald-900 border-emerald-700",children:m.map(s=>e.jsxs(z,{value:s.id.toString(),className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:[s.nomeDoLocal," (",s.address,")"]},s.id))})]})}),e.jsx(u,{children:e.jsx(x,{size:"sm",onClick:()=>(async e=>{const s=A[e];if(s)try{if(!(await r.put(`/chargers/${e}/assign-location`,{locationId:parseInt(s)})).ok)throw new Error("Falha ao atribuir o local.");t.success("Carregador associado com sucesso!"),R()}catch(a){t.error("Erro ao atribuir carregador")}else t.error("Selecione um local antes de salvar")})(s.charge_point_id),className:"bg-emerald-600 hover:bg-emerald-500 text-white shadow-lg shadow-emerald-900/30 transition-all",children:"Salvar"})})]},s.charge_point_id))})]})})]}),e.jsxs(l,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30 backdrop-blur-sm shadow-2xl shadow-emerald-900/20",children:[e.jsxs(d,{className:"border-b border-emerald-800/30 pb-6",children:[e.jsxs(i,{className:"text-emerald-50 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-emerald-400"}),"Carregadores Atribuídos"]}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Carregadores já associados a locais"})]}),e.jsx(n,{className:"pt-6",children:0===O.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(c,{className:"w-16 h-16 text-emerald-500/30 mb-4"}),e.jsx("p",{className:"text-xl text-emerald-300 font-semibold",children:"Nenhuma estação atribuída"}),e.jsx("p",{className:"text-base text-emerald-400/60 mt-2",children:M.length>0?"Atribua os carregadores pendentes acima a um local":"Conecte um carregador OCPP para começar"})]}):e.jsxs(j,{striped:!0,hoverable:!0,children:[e.jsx(b,{children:e.jsxs(p,{hoverable:!1,children:[e.jsx(g,{children:"Charge Point ID"}),e.jsx(g,{children:"Modelo"}),e.jsx(g,{children:"Fornecedor"}),e.jsx(g,{children:"Local"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Ações"})]})}),e.jsx(N,{children:O.map((s,a)=>{return e.jsxs(p,{index:a,children:[e.jsx(u,{className:"font-mono",children:e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-500/10 border border-emerald-500/20 text-emerald-300",children:s.charge_point_id})}),e.jsx(u,{className:"font-medium",children:s.model||"N/A"}),e.jsx(u,{className:"text-sm text-emerald-300/70",children:s.vendor||"N/A"}),e.jsx(u,{children:e.jsx("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-full bg-emerald-900/40 text-emerald-300 border border-emerald-700/30 text-sm",children:(r=s.locationId,r&&m.find(e=>e.id===r)?.nomeDoLocal||"Desconhecido")})}),e.jsx(u,{children:e.jsx(C,{status:s.isConnected?"online":"offline"})}),e.jsx(u,{children:e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>{I(s.charge_point_id),P(!0)},className:"border-emerald-700/50 text-emerald-300 hover:bg-emerald-900/40",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Detalhes"]})})]},s.charge_point_id);var r})})]})})]}),e.jsx(F,{chargePointId:k,open:D,onOpenChange:P,onUpdate:R})]})};export{M as Stations};
