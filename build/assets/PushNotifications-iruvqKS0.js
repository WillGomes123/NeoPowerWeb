import{j as e}from"./ui-vendor-D6QdPKSZ.js";import{a}from"./react-vendor-BVAhLato.js";import{c as s,f as l,t as r,x as t,B as c,y as i,I as d,U as m,M as n,C as o,d as x,a as h,b as j,g as p,l as g}from"./index-CZbXzKBK.js";import{T as u}from"./textarea-BaFR0fi7.js";import{S as N,a as f,b,c as v,d as w}from"./select-BL8F0bA5.js";import{D as y,f as C,a as E,b as S,c as k,d as T}from"./dialog-CePQXRrA.js";import{E as z,a as _,b as A,c as L,d as P,e as D}from"./EnhancedTable-B7a5Wd5c.js";import{P as M}from"./plus-BZRS4ChE.js";import{C as $,a as I}from"./circle-check-big-BTx50d3n.js";import{C as U}from"./circle-x-erO3nCEQ.js";import"./charts-BaPK5s1M.js";import"./x-jGKBHEEN.js";import"./table-C87ZYabE.js";
/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=s("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),F={draft:{label:"Rascunho",color:"bg-zinc-500",icon:p},scheduled:{label:"Agendada",color:"bg-blue-500",icon:p},sending:{label:"Enviando",color:"bg-yellow-500",icon:I},sent:{label:"Enviada",color:"bg-emerald-500",icon:$},failed:{label:"Falhou",color:"bg-red-500",icon:U}},B={all_users:"Todos os Usuários",specific_location:"Local Específico",specific_users:"Usuários Específicos"},R=()=>{const[s,p]=a.useState([]),[I,R]=a.useState(null),[V,H]=a.useState([]),[O,G]=a.useState(!0),[J,K]=a.useState(!1),[Q,W]=a.useState(null),[X,Y]=a.useState(""),[Z,ee]=a.useState(""),[ae,se]=a.useState("all_users"),[le,re]=a.useState("");a.useEffect(()=>{te()},[]);const te=async()=>{G(!0);try{const[e,a,s]=await Promise.all([l.get("/push/campaigns"),l.get("/push/stats"),l.get("/locations")]);if(e.ok){const a=await e.json();p(a.campaigns||[])}if(a.ok){const e=await a.json();R(e)}if(s.ok){const e=await s.json();H(e||[])}}catch(e){r.error("Erro ao carregar dados")}finally{G(!1)}},ce=()=>{Y(""),ee(""),se("all_users"),re("")};return O?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-emerald-400",children:"Carregando..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-emerald-50 flex items-center gap-3",children:[e.jsx(t,{className:"w-8 h-8 text-emerald-400"}),"Push Notifications"]}),e.jsx("p",{className:"text-emerald-300/60 mt-1",children:"Envie notificações para usuários do aplicativo"})]}),e.jsxs(y,{open:J,onOpenChange:K,children:[e.jsx(C,{asChild:!0,children:e.jsxs(c,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Nova Campanha"]})}),e.jsxs(E,{className:"bg-gradient-to-br from-emerald-950/95 to-emerald-900/95 border-emerald-800/50 text-emerald-50 max-w-lg",children:[e.jsxs(S,{children:[e.jsxs(k,{className:"text-emerald-50 flex items-center gap-2",children:[e.jsx(i,{className:"w-5 h-5 text-emerald-400"}),"Nova Campanha de Notificação"]}),e.jsx(T,{className:"text-emerald-300/60",children:"Crie uma notificação para enviar aos usuários do aplicativo"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-emerald-200",children:"Título da Notificação"}),e.jsx(d,{value:X,onChange:e=>Y(e.target.value),placeholder:"Ex: Promoção Especial!",className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50",maxLength:100}),e.jsxs("p",{className:"text-xs text-emerald-400/60",children:[X.length,"/100 caracteres"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-emerald-200",children:"Mensagem"}),e.jsx(u,{value:Z,onChange:e=>ee(e.target.value),placeholder:"Digite a mensagem da notificação...",className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 min-h-[100px]",maxLength:500}),e.jsxs("p",{className:"text-xs text-emerald-400/60",children:[Z.length,"/500 caracteres"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-emerald-200",children:"Público-Alvo"}),e.jsxs(N,{value:ae,onValueChange:se,children:[e.jsx(f,{className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50",children:e.jsx(b,{})}),e.jsxs(v,{className:"bg-emerald-900 border-emerald-700",children:[e.jsx(w,{value:"all_users",className:"text-emerald-50 focus:bg-emerald-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4"}),"Todos os Usuários"]})}),e.jsx(w,{value:"specific_location",className:"text-emerald-50 focus:bg-emerald-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-4 h-4"}),"Local Específico"]})})]})]})]}),"specific_location"===ae&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-emerald-200",children:"Selecione o Local"}),e.jsxs(N,{value:le,onValueChange:re,children:[e.jsx(f,{className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50",children:e.jsx(b,{placeholder:"Escolha um local"})}),e.jsx(v,{className:"bg-emerald-900 border-emerald-700",children:V.map(a=>e.jsx(w,{value:a.id.toString(),className:"text-emerald-50 focus:bg-emerald-800",children:a.nomeDoLocal},a.id))})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-zinc-900 rounded-lg border border-zinc-700",children:[e.jsx("p",{className:"text-xs text-zinc-400 mb-2",children:"Preview da Notificação:"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-600 rounded-lg flex items-center justify-center",children:e.jsx(i,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-white text-sm",children:X||"Título da Notificação"}),e.jsx("p",{className:"text-zinc-400 text-xs mt-0.5 line-clamp-2",children:Z||"Mensagem da notificação aparece aqui..."})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-emerald-800/30",children:[e.jsx(c,{variant:"outline",onClick:()=>K(!1),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 hover:bg-emerald-800/60",children:"Cancelar"}),e.jsx(c,{onClick:async()=>{if(X.trim()&&Z.trim())try{const e={title:X.trim(),message:Z.trim(),targetAudience:ae};"specific_location"===ae&&le&&(e.locationId=parseInt(le));if(!(await l.post("/push/campaigns",e)).ok)throw new Error("Erro ao criar campanha");r.success("Campanha criada com sucesso!"),K(!1),ce(),te()}catch(e){r.error("Erro ao criar campanha")}else r.error("Preencha o título e a mensagem")},className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Criar Campanha"})]})]})]})]}),I&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(o,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center",children:e.jsx(m,{className:"w-6 h-6 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-50",children:I.activeTokens}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Dispositivos Ativos"})]})]})})}),e.jsx(o,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center",children:e.jsx(t,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-50",children:I.totalCampaigns}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Total de Campanhas"})]})]})})}),e.jsx(o,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-50",children:I.totalSent}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Enviadas com Sucesso"})]})]})})}),e.jsx(o,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-50",children:I.totalFailed}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Falhas"})]})]})})})]}),e.jsxs(o,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:[e.jsx(h,{className:"border-b border-emerald-800/30 pb-6",children:e.jsxs(j,{className:"text-emerald-50 flex items-center gap-2",children:[e.jsx(i,{className:"w-5 h-5 text-emerald-400"}),"Campanhas"]})}),e.jsx(x,{className:"pt-6",children:0===s.length?e.jsxs("div",{className:"text-center py-12 text-emerald-300/60",children:[e.jsx(t,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma campanha criada ainda"}),e.jsx("p",{className:"text-sm mt-1",children:'Clique em "Nova Campanha" para começar'})]}):e.jsxs(z,{striped:!0,hoverable:!0,children:[e.jsx(_,{children:e.jsxs(A,{hoverable:!1,children:[e.jsx(L,{children:"Título"}),e.jsx(L,{children:"Mensagem"}),e.jsx(L,{children:"Público"}),e.jsx(L,{children:"Status"}),e.jsx(L,{children:"Enviadas"}),e.jsx(L,{children:"Data"}),e.jsx(L,{children:"Ações"})]})}),e.jsx(P,{children:s.map((a,s)=>{const t=F[a.status].icon;return e.jsxs(A,{index:s,children:[e.jsx(D,{className:"font-semibold text-emerald-100",children:a.title}),e.jsx(D,{className:"text-sm text-emerald-300/70 max-w-xs truncate",children:a.message}),e.jsx(D,{className:"text-sm text-emerald-300/70",children:B[a.targetAudience]}),e.jsx(D,{children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium text-white ${F[a.status].color}`,children:[e.jsx(t,{className:"w-3 h-3"}),F[a.status].label]})}),e.jsxs(D,{className:"text-sm",children:[e.jsx("span",{className:"text-emerald-400",children:a.sentCount}),a.failedCount>0&&e.jsxs("span",{className:"text-red-400 ml-1",children:["/ ",a.failedCount," falhas"]})]}),e.jsx(D,{className:"text-sm text-emerald-300/70",children:(i=a.sentAt||a.createdAt,i?new Date(i).toLocaleString("pt-BR"):"-")}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[("draft"===a.status||"scheduled"===a.status)&&e.jsxs(c,{size:"sm",onClick:()=>(async e=>{W(e);try{const a=await l.post(`/push/campaigns/${e}/send`);if(!a.ok){const e=await a.json();throw new Error(e.error||"Erro ao enviar")}const s=await a.json();r.success(`Campanha enviada! ${s.sent} enviados, ${s.failed} falharam`),te()}catch(a){r.error(a.message||"Erro ao enviar campanha")}finally{W(null)}})(a.id),disabled:Q===a.id,className:"bg-emerald-600 hover:bg-emerald-700 text-white h-8 px-3",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),Q===a.id?"Enviando...":"Enviar"]}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir esta campanha?"))try{if(!(await l.delete(`/push/campaigns/${e}`)).ok)throw new Error("Erro ao excluir");r.success("Campanha excluída"),te()}catch(a){r.error("Erro ao excluir campanha")}})(a.id),disabled:"sending"===a.status,className:"text-red-400 hover:text-red-300 hover:bg-red-500/20 h-8 px-2",children:e.jsx(g,{className:"w-4 h-4"})})]})})]},a.id);var i})})]})})]})]})};export{R as PushNotifications,R as default};
