import{j as e,E as a,G as s,e as r,W as t,b as l,H as d,f as o,J as c,K as n,M as i,N as m,O as x,Q as h}from"./ui-vendor-D6QdPKSZ.js";import{a as u}from"./react-vendor-BVAhLato.js";import{h as p,o as j,f as g,t as f,B as v,C as N,d as b,i as y,I as _,M as w,Z as D,S as A,a as C,b as S,T as k,l as R}from"./index-CZbXzKBK.js";import{E as q,a as E,b as V,c as F,d as $,e as T}from"./EnhancedTable-B7a5Wd5c.js";import{T as I}from"./textarea-BaFR0fi7.js";import{S as z,a as O,b as L,c as P,d as B}from"./select-BL8F0bA5.js";import{S as W}from"./StatusBadge-CpFu7tRe.js";import{A as G}from"./arrow-left-C3ElynVd.js";import{P as Q}from"./plus-BZRS4ChE.js";import{S as H}from"./square-pen-B2T0eStT.js";import"./charts-BaPK5s1M.js";import"./table-C87ZYabE.js";import"./badge-CBA_3OHO.js";var M=Symbol("radix.slottable");var J="AlertDialog",[K]=l(J,[a]),U=a(),Y=a=>{const{__scopeAlertDialog:r,...t}=a,l=U(r);return e.jsx(s,{...l,...t,modal:!0})};Y.displayName=J;u.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...t}=a,l=U(r);return e.jsx(h,{...l,...t,ref:s})}).displayName="AlertDialogTrigger";var Z=a=>{const{__scopeAlertDialog:s,...r}=a,t=U(s);return e.jsx(m,{...t,...r})};Z.displayName="AlertDialogPortal";var X=u.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...t}=a,l=U(r);return e.jsx(x,{...l,...t,ref:s})});X.displayName="AlertDialogOverlay";var ee="AlertDialogContent",[ae,se]=K(ee),re=function(a){const s=({children:a})=>e.jsx(e.Fragment,{children:a});return s.displayName=`${a}.Slottable`,s.__radixId=M,s}("AlertDialogContent"),te=u.forwardRef((a,s)=>{const{__scopeAlertDialog:l,children:c,...n}=a,i=U(l),m=u.useRef(null),x=r(s,m),h=u.useRef(null);return e.jsx(t,{contentName:ee,titleName:le,docsSlug:"alert-dialog",children:e.jsx(ae,{scope:l,cancelRef:h,children:e.jsxs(d,{role:"alertdialog",...i,...n,ref:x,onOpenAutoFocus:o(n.onOpenAutoFocus,e=>{e.preventDefault(),h.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[e.jsx(re,{children:c}),e.jsx(xe,{contentRef:m})]})})})});te.displayName=ee;var le="AlertDialogTitle",de=u.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...t}=a,l=U(r);return e.jsx(c,{...l,...t,ref:s})});de.displayName=le;var oe="AlertDialogDescription",ce=u.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...t}=a,l=U(r);return e.jsx(n,{...l,...t,ref:s})});ce.displayName=oe;var ne=u.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...t}=a,l=U(r);return e.jsx(i,{...l,...t,ref:s})});ne.displayName="AlertDialogAction";var ie="AlertDialogCancel",me=u.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...l}=a,{cancelRef:d}=se(ie,t),o=U(t),c=r(s,d);return e.jsx(i,{...o,...l,ref:c})});me.displayName=ie;var xe=({contentRef:e})=>{const a=`\`${ee}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${ee}\` by passing a \`${oe}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${ee}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return u.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[a,e]),null},he=Y,ue=Z,pe=X,je=te,ge=ne,fe=me,ve=de,Ne=ce;function be({...a}){return e.jsx(he,{"data-slot":"alert-dialog",...a})}function ye({...a}){return e.jsx(ue,{"data-slot":"alert-dialog-portal",...a})}function _e({className:a,...s}){return e.jsx(pe,{"data-slot":"alert-dialog-overlay",className:p("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...s})}function we({className:a,...s}){return e.jsxs(ye,{children:[e.jsx(_e,{}),e.jsx(je,{"data-slot":"alert-dialog-content",className:p("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...s})]})}function De({className:a,...s}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:p("flex flex-col gap-2 text-center sm:text-left",a),...s})}function Ae({className:a,...s}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:p("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...s})}function Ce({className:a,...s}){return e.jsx(ve,{"data-slot":"alert-dialog-title",className:p("text-lg font-semibold",a),...s})}function Se({className:a,...s}){return e.jsx(Ne,{"data-slot":"alert-dialog-description",className:p("text-muted-foreground text-sm",a),...s})}function ke({className:a,...s}){return e.jsx(ge,{className:p(j(),a),...s})}function Re({className:a,...s}){return e.jsx(fe,{className:p(j({variant:"outline"}),a),...s})}const qe=()=>{const[a,s]=u.useState([]),[r,t]=u.useState([]),[l,d]=u.useState([]),[o,c]=u.useState(!0),[n,i]=u.useState(!1),[m,x]=u.useState(null),[h,p]=u.useState(null);u.useEffect(()=>{J(),j(),M()},[]);const j=async()=>{try{const e=await g.get("/locations");if(e.ok){const a=await e.json();t(a)}}catch(e){}},M=async()=>{try{const e=await g.get("/chargers");if(e.ok){const a=await e.json();d(a)}}catch(e){}},J=async()=>{c(!0);try{const e=await g.get("/vouchers");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json();s(a)}catch(e){f.error("Erro ao buscar vouchers"),s([])}finally{c(!1)}},K=async()=>{if(!m)return;const e=m.id?g.put:g.post,a=m.id?`/vouchers/${m.id}`:"/vouchers";try{if(!(await e(a,{...m,total_quantity:m.total_quantity||null,start_date:m.start_date||null,end_date:m.end_date||null,location_id:m.location_id||null,charger_id:m.charger_id||null})).ok)throw new Error(`Falha ao ${m.id?"atualizar":"criar"} voucher.`);f.success(`Voucher ${m.id?"atualizado":"criado"} com sucesso!`),i(!1),x(null),J()}catch(s){f.error(`Erro: ${s instanceof Error?s.message:"Erro desconhecido"}`)}},U=()=>{i(!1),x(null)};return o&&!n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-emerald-400",children:"Carregando vouchers..."})}):n&&m?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(v,{onClick:U,variant:"ghost",className:"text-emerald-300 hover:text-emerald-100 hover:bg-emerald-900/30",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-emerald-50",children:m.id?"Editar Voucher":"Criar Voucher"}),e.jsx("p",{className:"text-emerald-300/60 mt-1",children:"Preencha os dados do voucher"})]}),e.jsx(N,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30 backdrop-blur-sm shadow-2xl shadow-emerald-900/20",children:e.jsxs(b,{className:"pt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"code",className:"text-emerald-200",children:"Código do Voucher"}),e.jsx(_,{id:"code",value:m.code,onChange:e=>x({...m,code:e.target.value}),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600",placeholder:"CODIGO123",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",className:"text-emerald-200",children:"Nome do Voucher"}),e.jsx(_,{id:"name",value:m.name,onChange:e=>x({...m,name:e.target.value}),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600",placeholder:"Nome descritivo",required:!0})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(y,{htmlFor:"description",className:"text-emerald-200",children:"Descrição"}),e.jsx(I,{id:"description",value:m.description||"",onChange:e=>x({...m,description:e.target.value}),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600",placeholder:"Descrição do voucher",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"type",className:"text-emerald-200",children:"Tipo de Desconto"}),e.jsxs(z,{value:m.type,onValueChange:e=>x({...m,type:e}),children:[e.jsx(O,{className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600",children:e.jsx(L,{})}),e.jsxs(P,{className:"bg-emerald-900 border-emerald-700",children:[e.jsx(B,{value:"percent",className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:"Percentagem (%)"}),e.jsx(B,{value:"fixed",className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:"Reais (R$)"}),e.jsx(B,{value:"kwh",className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:"Quilowatt-hora (kWh)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"value",className:"text-emerald-200",children:"Valor"}),e.jsx(_,{id:"value",type:"number",step:"0.01",value:m.value,onChange:e=>x({...m,value:parseFloat(e.target.value)||0}),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"start_date",className:"text-emerald-200",children:"Data de Início"}),e.jsx(_,{id:"start_date",type:"date",value:m.start_date||"",onChange:e=>x({...m,start_date:e.target.value}),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"end_date",className:"text-emerald-200",children:"Válido Até"}),e.jsx(_,{id:"end_date",type:"date",value:m.end_date||"",onChange:e=>x({...m,end_date:e.target.value}),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"total_quantity",className:"text-emerald-200",children:"Quantidade Total (deixe em branco para ilimitado)"}),e.jsx(_,{id:"total_quantity",type:"number",value:m.total_quantity||"",onChange:e=>x({...m,total_quantity:e.target.value?parseInt(e.target.value):null}),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600",placeholder:"Ilimitado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"location_id",className:"text-emerald-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-emerald-400"}),"Restringir a Local (opcional)"]})}),e.jsxs(z,{value:m.location_id?.toString()||"none",onValueChange:e=>x({...m,location_id:"none"===e?null:parseInt(e),charger_id:"none"===e?m.charger_id:null}),children:[e.jsx(O,{className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600",children:e.jsx(L,{placeholder:"Todos os locais"})}),e.jsxs(P,{className:"bg-emerald-900 border-emerald-700",children:[e.jsx(B,{value:"none",className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:"Todos os locais"}),r.map(a=>e.jsxs(B,{value:a.id.toString(),className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:[a.nomeDoLocal," - ",a.address]},a.id))]})]}),e.jsx("p",{className:"text-xs text-emerald-300/50",children:"Se selecionado, o voucher só pode ser usado neste local"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"charger_id",className:"text-emerald-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-emerald-400"}),"Restringir a Carregador (opcional)"]})}),e.jsxs(z,{value:m.charger_id||"none",onValueChange:e=>x({...m,charger_id:"none"===e?null:e,location_id:"none"===e?m.location_id:null}),children:[e.jsx(O,{className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600",children:e.jsx(L,{placeholder:"Todos os carregadores"})}),e.jsxs(P,{className:"bg-emerald-900 border-emerald-700",children:[e.jsx(B,{value:"none",className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:"Todos os carregadores"}),l.map(a=>e.jsxs(B,{value:a.chargerId,className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:[a.chargerId," ",a.model?`(${a.model})`:""," ",a.locationAddress?`- ${a.locationAddress}`:""]},a.chargerId))]})]}),e.jsx("p",{className:"text-xs text-emerald-300/50",children:"Se selecionado, o voucher só pode ser usado neste carregador específico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"is_active",className:"text-emerald-200",children:"Ativar Voucher"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(A,{id:"is_active",checked:m.is_active,onCheckedChange:e=>x({...m,is_active:e}),className:"data-[state=checked]:bg-emerald-600"}),e.jsx(y,{htmlFor:"is_active",className:"text-emerald-300/70 cursor-pointer",children:m.is_active?"Ativo":"Inativo"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(v,{onClick:U,variant:"outline",className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-100 hover:bg-emerald-800/50",children:"Cancelar"}),e.jsx(v,{onClick:K,className:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-900/30",children:"Salvar Voucher"})]})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-emerald-50",children:"Vouchers"}),e.jsx("p",{className:"text-emerald-300/60 mt-1",children:"Gerenciamento de cupons e descontos"})]}),e.jsxs(v,{onClick:()=>{x({code:"",name:"",description:"",type:"percent",value:0,is_active:!0,start_date:"",end_date:"",total_quantity:null,location_id:null,charger_id:null}),i(!0)},className:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-900/30",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Novo Voucher"]})]}),e.jsxs(N,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30 backdrop-blur-sm shadow-2xl shadow-emerald-900/20",children:[e.jsx(C,{children:e.jsxs(S,{className:"text-emerald-50 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-emerald-400"}),"Lista de Vouchers"]})}),e.jsx(b,{children:0===a.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(k,{className:"w-16 h-16 text-emerald-500/30 mb-4"}),e.jsx("p",{className:"text-xl text-emerald-300 font-semibold",children:"Nenhum voucher criado"}),e.jsx("p",{className:"text-base text-emerald-400/60 mt-2",children:'Clique em "Novo Voucher" para criar cupons de desconto'})]}):e.jsxs(q,{children:[e.jsx(E,{children:e.jsxs(V,{children:[e.jsx(F,{children:"Código"}),e.jsx(F,{children:"Nome"}),e.jsx(F,{children:"Tipo"}),e.jsx(F,{children:"Valor"}),e.jsx(F,{children:"Restrição"}),e.jsx(F,{children:"Validade"}),e.jsx(F,{children:"Uso"}),e.jsx(F,{children:"Status"}),e.jsx(F,{children:"Ações"})]})}),e.jsx($,{children:a.map((a,s)=>e.jsxs(V,{index:s,children:[e.jsx(T,{className:"font-mono",children:e.jsx("span",{className:"px-2 py-1 rounded bg-emerald-500/10 border border-emerald-500/20 text-emerald-300",children:a.code})}),e.jsx(T,{className:"font-medium",children:a.name}),e.jsx(T,{children:e.jsxs("span",{className:"capitalize inline-flex items-center gap-1.5 px-2 py-1 rounded-full bg-emerald-900/40 text-emerald-300 border border-emerald-700/30",children:["percent"===a.type&&"%","fixed"===a.type&&"R$","kwh"===a.type&&"kWh",e.jsx("span",{className:"text-xs opacity-75",children:a.type})]})}),e.jsx(T,{highlight:!0,children:e.jsxs("span",{className:"text-lg font-semibold",children:[a.value," ",{percent:"%",fixed:"R$",kwh:"kWh"}[a.type]]})}),e.jsx(T,{children:a.location_id||a.charger_id?e.jsxs("div",{className:"flex items-center gap-2",children:[a.location_id&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-500/10 text-blue-300 border border-blue-500/20 text-xs",children:[e.jsx(w,{className:"w-3 h-3"}),r.find(e=>e.id===a.location_id)?.nomeDoLocal||`Local #${a.location_id}`]}),a.charger_id&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-500/10 text-yellow-300 border border-yellow-500/20 text-xs",children:[e.jsx(D,{className:"w-3 h-3"}),a.charger_id]})]}):e.jsx("span",{className:"text-emerald-300/50 text-sm",children:"Sem restrição"})}),e.jsx(T,{className:"text-sm",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("span",{className:"text-emerald-300/70",children:["De:"," ",a.start_date?new Date(a.start_date).toLocaleDateString("pt-BR"):"N/A"]}),e.jsxs("span",{className:"text-emerald-300/70",children:["Até:"," ",a.end_date?new Date(a.end_date).toLocaleDateString("pt-BR"):"N/A"]})]})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-emerald-950/50 rounded-full h-2 overflow-hidden border border-emerald-700/30",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500",style:{width:(a.total_quantity?(a.used_quantity||0)/a.total_quantity*100:0)+"%"}})}),e.jsxs("span",{className:"text-sm font-medium whitespace-nowrap",children:[a.used_quantity||0,"/",a.total_quantity||"∞"]})]})}),e.jsx(T,{children:e.jsx(W,{status:a.is_active?"active":"inactive"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{size:"sm",variant:"ghost",onClick:e=>{e.stopPropagation(),(e=>{const a=e=>e?new Date(e).toISOString().split("T")[0]:"";x({...e,start_date:a(e.start_date),end_date:a(e.end_date)}),i(!0)})(a)},className:"text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/20 hover:shadow-lg hover:shadow-emerald-500/20 transition-all duration-300 border border-transparent hover:border-emerald-500/30",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(v,{size:"sm",variant:"ghost",onClick:e=>{var s;e.stopPropagation(),a.id&&(s=a.id,p(s))},className:"text-red-400 hover:text-red-300 hover:bg-red-500/20 hover:shadow-lg hover:shadow-red-500/20 transition-all duration-300 border border-transparent hover:border-red-500/30",children:e.jsx(R,{className:"w-4 h-4"})})]})})]},a.id))})]})})]}),e.jsx(be,{open:null!==h,onOpenChange:e=>!e&&p(null),children:e.jsxs(we,{children:[e.jsxs(De,{children:[e.jsx(Ce,{children:"Confirmar Exclusão"}),e.jsx(Se,{children:"Tem certeza que deseja excluir este voucher? Esta ação não pode ser desfeita."})]}),e.jsxs(Ae,{children:[e.jsx(Re,{children:"Cancelar"}),e.jsx(ke,{onClick:async()=>{if(h)try{const e=await g.delete(`/vouchers/${h}`);if(!e.ok){const a=await e.json();throw new Error(a.error||"Falha ao excluir voucher.")}f.success("Voucher excluído com sucesso!"),J()}catch(e){f.error(`Erro: ${e instanceof Error?e.message:"Erro desconhecido"}`)}finally{p(null)}},className:"bg-red-500 hover:bg-red-600",children:"Excluir"})]})]})})]})};export{qe as Vouchers};
