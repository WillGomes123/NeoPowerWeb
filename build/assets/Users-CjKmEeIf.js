import{j as e}from"./ui-vendor-D6QdPKSZ.js";import{a as s}from"./react-vendor-BVAhLato.js";import{c as a,f as r,t as l,U as o,C as d,a as t,b as c,d as i,I as n,B as m,j as x,M as h}from"./index-BaJa-ZGP.js";import{E as u,a as j,b as p,c as b,d as f,e as N}from"./EnhancedTable-DB0V6gm6.js";import{S as g,a as w,b as v,c as y,d as k}from"./select-DGz8aZRk.js";import{D as E,f as C,a as S,b as $,c as A,d as L}from"./dialog-BkZWeYAN.js";import{X as z}from"./x-OVfnIpib.js";import{P as F}from"./phone-KTg13Prr.js";import"./charts-BaPK5s1M.js";import"./table-KAkNip0H.js";
/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=a("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),G=()=>{const[a,G]=s.useState([]),[M,q]=s.useState([]),[D,I]=s.useState(!0),[P,R]=s.useState(null),[U,B]=s.useState([]),[V,O]=s.useState(!1),[H,J]=s.useState(null),[K,Q]=s.useState("");s.useEffect(()=>{W(),X()},[]);const W=async()=>{I(!0);try{const e=await r.get("/admin/users");if(!e.ok)throw new Error("Network response was not ok");const s=await e.json();G(s)}catch(e){l.error("Erro ao buscar usuários")}finally{I(!1)}},X=async()=>{try{const e=await r.get("/locations");if(!e.ok)throw new Error("Network response was not ok");const s=await e.json();q(s)}catch(e){l.error("Erro ao buscar locais")}},Y=async e=>{if(P&&e)try{if(!(await r.post(`/admin/users/${P.id}/locations`,{locationAddress:e})).ok)throw new Error("Failed to add location");B(s=>[...s,e]),l.success("Local adicionado com sucesso!")}catch(s){l.error("Erro ao adicionar local")}},Z=()=>{J(null),Q("")},_=e=>{if(!e)return"-";const s=e.replace(/\D/g,"");return 11===s.length?`(${s.slice(0,2)}) ${s.slice(2,7)}-${s.slice(7)}`:10===s.length?`(${s.slice(0,2)}) ${s.slice(2,6)}-${s.slice(6)}`:e};return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-emerald-400",children:"Carregando usuários..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-emerald-50 flex items-center gap-3",children:[e.jsx(o,{className:"w-8 h-8 text-emerald-400"}),"Usuários"]}),e.jsx("p",{className:"text-emerald-300/60 mt-1",children:"Gerenciamento de usuários e permissões"})]}),e.jsxs(d,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30 backdrop-blur-sm shadow-2xl shadow-emerald-900/20",children:[e.jsxs(t,{className:"border-b border-emerald-800/30 pb-6",children:[e.jsxs(c,{className:"text-emerald-50 flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 text-emerald-400"}),"Lista de Usuários"]}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Gerencie funções e acessos"})]}),e.jsx(i,{className:"pt-6",children:e.jsxs(u,{striped:!0,hoverable:!0,children:[e.jsx(j,{children:e.jsxs(p,{hoverable:!1,children:[e.jsx(b,{children:"Nome"}),e.jsx(b,{children:"Email"}),e.jsx(b,{children:"Telefone"}),e.jsx(b,{children:"Função"}),e.jsx(b,{children:"Locais"}),e.jsx(b,{children:"Ações"})]})}),e.jsx(f,{children:a.map((s,a)=>e.jsxs(p,{index:a,children:[e.jsx(N,{className:"font-semibold text-emerald-100",children:s.name}),e.jsx(N,{className:"text-sm text-emerald-300/70",children:s.email}),e.jsx(N,{children:H===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{type:"tel",value:K,onChange:e=>Q(e.target.value),placeholder:"(92) 99999-9999",className:"w-36 h-8 bg-emerald-900/40 border-emerald-700/50 text-emerald-50 text-sm"}),e.jsx(m,{size:"icon",variant:"ghost",onClick:()=>(async e=>{try{if(!(await r.put(`/admin/users/${e}`,{phone:K||null})).ok)throw new Error("Failed to update phone");l.success("Telefone atualizado com sucesso!"),J(null),Q(""),W()}catch(s){l.error("Erro ao atualizar telefone")}})(s.id),className:"h-8 w-8 text-emerald-400 hover:text-emerald-300 hover:bg-emerald-800/40",children:e.jsx(x,{className:"w-4 h-4"})}),e.jsx(m,{size:"icon",variant:"ghost",onClick:Z,className:"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-800/20",children:e.jsx(z,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-emerald-500/60"}),e.jsx("span",{className:"text-sm text-emerald-300/70",children:_(s.phone)}),e.jsx(m,{size:"icon",variant:"ghost",onClick:()=>(e=>{J(e.id),Q(e.phone||"")})(s),className:"h-6 w-6 text-emerald-400/60 hover:text-emerald-300 hover:bg-emerald-800/40",children:e.jsx(T,{className:"w-3 h-3"})})]})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{value:s.role,onValueChange:e=>(async(e,s)=>{try{if(!(await r.put(`/admin/users/${e}/role`,{newRole:s})).ok)throw new Error("Failed to update role");l.success("Role atualizada com sucesso!"),W()}catch(a){l.error("Falha ao atualizar a role.")}})(s.id,e),children:[e.jsx(w,{className:"w-[150px] bg-emerald-900/40 border-emerald-700/50 text-emerald-50 hover:bg-emerald-800/60",children:e.jsx(v,{})}),e.jsxs(y,{className:"bg-emerald-900 border-emerald-700",children:[e.jsx(k,{value:"admin",className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:"Admin"}),e.jsx(k,{value:"atem",className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:"ATEM"}),e.jsx(k,{value:"comum",className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:"Comum"}),e.jsx(k,{value:"blocked",className:"text-red-200 focus:bg-red-900/40 focus:text-red-100",children:"Bloqueado"})]})]}),e.jsxs("p",{className:"text-xs text-emerald-300/60",children:["admin"===s.role&&"Acesso total","atem"===s.role&&"Tema ATEM, acessos limitados","comum"===s.role&&"Tema NeoPower padrão","blocked"===s.role&&"Sem acesso ao dashboard"]})]})}),e.jsx(N,{children:s.locationIds?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-full bg-emerald-900/40 text-emerald-300 border border-emerald-700/30 text-sm font-medium",children:[s.locationIds.length," local(is)"]}):e.jsx("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 text-sm font-medium",children:"Todos"})}),e.jsx(N,{children:"admin"!==s.role&&"blocked"!==s.role&&e.jsxs(E,{open:V&&P?.id===s.id,onOpenChange:e=>{O(e),e||R(null)},children:[e.jsxs(C,{onClick:()=>(async e=>{R(e);try{const s=await r.get(`/admin/users/${e.id}/locations`);if(!s.ok)throw new Error("Network response was not ok");const a=await s.json();B(a.map(e=>e.locationAddress)),O(!0)}catch(s){l.error("Erro ao buscar locais do usuário")}})(s),className:"inline-flex items-center justify-center gap-2 rounded-md text-sm px-3 py-2 bg-emerald-900/40 border border-emerald-700/50 text-emerald-50 hover:bg-emerald-800/60 hover:border-emerald-600 transition-all shadow-lg shadow-emerald-900/20",children:[e.jsx(h,{className:"w-4 h-4"}),"Gerenciar Locais"]}),e.jsxs(S,{className:"bg-gradient-to-br from-emerald-950/95 to-emerald-900/95 border-emerald-800/50 text-emerald-50 backdrop-blur-xl",children:[e.jsxs($,{children:[e.jsxs(A,{className:"text-emerald-50",children:["Gerenciar Locais - ",s.name]}),e.jsx(L,{className:"text-emerald-300/60",children:"Adicione ou remova locais que este usuário pode acessar"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-emerald-200 text-sm",children:"Adicionar Local"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(g,{onValueChange:Y,children:[e.jsx(w,{className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 focus:border-emerald-600 flex-1",children:e.jsx(v,{placeholder:"Selecione um local"})}),e.jsx(y,{className:"bg-emerald-900 border-emerald-700",children:M.filter(e=>!U.includes(e.address)).map(s=>e.jsxs(k,{value:s.address,className:"text-emerald-50 focus:bg-emerald-800 focus:text-emerald-50",children:[s.nomeDoLocal," (",s.address,")"]},s.id))})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-emerald-200 text-sm",children:"Locais Permitidos:"}),0===U.length?e.jsx("p",{className:"text-emerald-300/60 text-sm",children:"Nenhum local atribuído"}):e.jsx("ul",{className:"space-y-2",children:U.map(s=>e.jsxs("li",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-900/30 border border-emerald-800/40",children:[e.jsx("span",{className:"text-emerald-100",children:s}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>(async e=>{if(P)try{if(!(await r.delete(`/admin/users/${P.id}/locations`,{locationAddress:e})).ok)throw new Error("Failed to remove location");B(s=>s.filter(s=>s!==e)),l.success("Local removido com sucesso!")}catch(s){l.error("Erro ao remover local")}})(s),className:"text-red-400 hover:text-red-300 hover:bg-red-500/20",children:"Remover"})]},s))})]})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-4 border-t border-emerald-800/30",children:e.jsx(m,{variant:"outline",onClick:()=>O(!1),className:"bg-emerald-900/40 border-emerald-700/50 text-emerald-50 hover:bg-emerald-800/60",children:"Fechar"})})]})]})})]},s.id))})]})})]})]})};export{G as Users};
