import{j as e}from"./ui-vendor-D6QdPKSZ.js";import{a}from"./react-vendor-BVAhLato.js";import{c as s,B as r,h as t,I as i,C as c,a as l,b as n,D as d,l as o,d as x,M as m,f as h,t as j}from"./index-BaJa-ZGP.js";import{S as p,a as f,b as N,c as u,d as b}from"./select-DGz8aZRk.js";import{T as g,a as z,b as v,c as y,d as w,e as S}from"./table-KAkNip0H.js";import{D as k,f as T,a as _,b as A,c as C,d as D,e as P}from"./dialog-BkZWeYAN.js";import{B}from"./badge-CIrDOdUW.js";import{P as F}from"./plus-ZXf-gh-s.js";import"./charts-BaPK5s1M.js";import"./x-OVfnIpib.js";
/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=s("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),W=()=>{const[s,W]=a.useState(null),[E,L]=a.useState([]),[M,R]=a.useState([]),[I,q]=a.useState(!0),[H,O]=a.useState(!1),[V,$]=a.useState(""),[J,K]=a.useState("global"),[Q,U]=a.useState(!1),X=async()=>{q(!0);try{const[e,a]=await Promise.all([h.get("/tariffs/current"),h.get("/locations")]);if(e.ok){const a=await e.json();W(a.tariff||a),a.history&&L(a.history)}if(a.ok){const e=await a.json();R(Array.isArray(e)?e:e.locations||[])}}catch{j.error("Erro ao carregar dados de tarifas")}finally{q(!1)}};a.useEffect(()=>{X()},[]);const Y=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),Z=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return I?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestão de Tarifas"}),e.jsx("p",{className:"text-zinc-400",children:"Gerencie os preços por kWh"})]}),e.jsxs(k,{open:H,onOpenChange:O,children:[e.jsx(T,{asChild:!0,children:e.jsxs(r,{className:"bg-emerald-600 hover:bg-emerald-700",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Nova Tarifa"]})}),e.jsxs(_,{className:"bg-zinc-900 border-zinc-800",children:[e.jsxs(A,{children:[e.jsx(C,{className:"text-white",children:"Definir Nova Tarifa"}),e.jsx(D,{className:"text-zinc-400",children:"Configure o preço por kWh para a rede ou para um local específico."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"price",className:"text-zinc-300",children:"Preço por kWh (R$)"}),e.jsx(i,{id:"price",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:V,onChange:e=>$(e.target.value),className:"bg-zinc-800 border-zinc-700 text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"location",className:"text-zinc-300",children:"Aplicar para"}),e.jsxs(p,{value:J,onValueChange:K,children:[e.jsx(f,{className:"bg-zinc-800 border-zinc-700 text-white",children:e.jsx(N,{placeholder:"Selecione"})}),e.jsxs(u,{className:"bg-zinc-800 border-zinc-700",children:[e.jsx(b,{value:"global",className:"text-white",children:"Tarifa Global (toda a rede)"}),M.map(a=>e.jsx(b,{value:a.id.toString(),className:"text-white",children:a.name},a.id))]})]})]})]}),e.jsxs(P,{children:[e.jsx(r,{variant:"outline",onClick:()=>O(!1),className:"border-zinc-700 text-zinc-300",children:"Cancelar"}),e.jsx(r,{onClick:async()=>{if(!V||parseFloat(V)<=0)j.error("Informe um preço válido");else{U(!0);try{const e={newPrice:parseFloat(V)};if("global"!==J){const a=M.find(e=>e.id.toString()===J);a&&(e.locationAddress=a.address)}const a=await h.post("/tariffs",e);if(a.ok)j.success("Tarifa atualizada com sucesso!"),O(!1),$(""),K("global"),X();else{const e=await a.json();j.error(e.error||"Erro ao atualizar tarifa")}}catch{j.error("Erro ao atualizar tarifa")}finally{U(!1)}}},disabled:Q,className:"bg-emerald-600 hover:bg-emerald-700",children:Q?"Salvando...":"Salvar Tarifa"})]})]})]})]}),e.jsxs(c,{className:"bg-zinc-900/50 border-zinc-800",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"text-white flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5 text-emerald-500"}),"Tarifa Atual"]}),e.jsx(o,{className:"text-zinc-400",children:"Preço vigente para carregamentos"})]}),e.jsx(x,{children:s?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-4xl font-bold text-emerald-500",children:[Y(s.price_per_kwh),e.jsx("span",{className:"text-lg text-zinc-400 font-normal",children:"/kWh"})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:s.location_address?e.jsxs(B,{variant:"outline",className:"border-blue-500 text-blue-400",children:[e.jsx(m,{className:"h-3 w-3 mr-1"}),s.location_address]}):e.jsx(B,{variant:"outline",className:"border-emerald-500 text-emerald-400",children:"Tarifa Global"})})]}),e.jsxs("div",{className:"text-right text-zinc-400 text-sm",children:[e.jsx("p",{children:"Atualizado em"}),e.jsx("p",{className:"text-white",children:Z(s.created_at)})]})]}):e.jsx("p",{className:"text-zinc-400",children:"Nenhuma tarifa configurada"})})]}),e.jsxs(c,{className:"bg-zinc-900/50 border-zinc-800",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"text-white flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-zinc-400"}),"Histórico de Tarifas"]}),e.jsx(o,{className:"text-zinc-400",children:"Alterações anteriores de preço"})]}),e.jsx(x,{children:E.length>0?e.jsxs(g,{children:[e.jsx(z,{children:e.jsxs(v,{className:"border-zinc-800",children:[e.jsx(y,{className:"text-zinc-400",children:"Data"}),e.jsx(y,{className:"text-zinc-400",children:"Preço/kWh"}),e.jsx(y,{className:"text-zinc-400",children:"Local"}),e.jsx(y,{className:"text-zinc-400",children:"Status"})]})}),e.jsx(w,{children:E.map(a=>e.jsxs(v,{className:"border-zinc-800",children:[e.jsx(S,{className:"text-zinc-300",children:Z(a.created_at)}),e.jsx(S,{className:"text-white font-medium",children:Y(a.price_per_kwh)}),e.jsx(S,{className:"text-zinc-300",children:a.location_address||"Global"}),e.jsx(S,{children:a.is_current?e.jsx(B,{className:"bg-emerald-500/20 text-emerald-400",children:"Atual"}):e.jsx(B,{variant:"outline",className:"border-zinc-600 text-zinc-400",children:"Anterior"})})]},a.id))})]}):e.jsx("p",{className:"text-zinc-400 text-center py-8",children:"Nenhum histórico disponível"})})]})]})};export{W as Tariffs,W as default};
