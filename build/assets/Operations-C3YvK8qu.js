import{j as e}from"./ui-vendor-D6QdPKSZ.js";import{a}from"./react-vendor-BVAhLato.js";import{c as s,B as r,i as t,I as l,f as d,R as c,C as n,d as i,a as o,b as m,Z as x,g as h,t as p}from"./index-CZbXzKBK.js";import{D as g,a as j,b as u,c as b,d as N,e as v}from"./dialog-CePQXRrA.js";import{S as f,a as w,b as y,c as C,d as I}from"./select-BL8F0bA5.js";import{W as k,a as S}from"./wifi-BGmL9QME.js";import{A as _}from"./activity-RP9HCYsq.js";import{C as E}from"./chevron-right-BEibx5W9.js";import{C as T}from"./circle-check-D_QM8xAl.js";import{C as O}from"./circle-x-erO3nCEQ.js";import"./charts-BaPK5s1M.js";import"./x-jGKBHEEN.js";
/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=s("circle-stop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]),M=s("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),D=s("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),R=s("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),q=s("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),P=s("terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),F=({open:s,onOpenChange:d,commandType:c,chargerName:n,onConfirm:i})=>{const[o,m]=a.useState({});return e.jsx(g,{open:s,onOpenChange:d,children:e.jsx(j,{className:"sm:max-w-[500px]",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault();const a={};Object.entries(o).forEach(([e,s])=>{["transactionId","connectorId"].includes(e)?a[e]=parseInt(s)||0:a[e]=s}),i(a),m({}),d(!1)},children:[e.jsxs(u,{children:[e.jsx(b,{children:{start:"Iniciar Transação Remota",stop:"Parar Transação Remota",reset:"Resetar Carregador",availability:"Alterar Disponibilidade",unlock:"Destravar Conector",triggerMessage:"Disparar Mensagem OCPP"}[c]||"Executar Comando"}),e.jsxs(N,{children:["Carregador: ",e.jsx("span",{className:"font-semibold text-emerald-400",children:n})]})]}),e.jsx("div",{className:"py-6",children:(()=>{switch(c){case"start":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"idTag",children:"ID Tag"}),e.jsx(l,{id:"idTag",placeholder:"Ex: 12345",value:o.idTag||"",onChange:e=>m({...o,idTag:e.target.value}),required:!0}),e.jsx("p",{className:"text-sm text-zinc-400",children:"Identificador do cartão/tag RFID"})]})});case"stop":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"transactionId",children:"ID da Transação"}),e.jsx(l,{id:"transactionId",type:"number",placeholder:"Ex: 123",value:o.transactionId||"",onChange:e=>m({...o,transactionId:e.target.value}),required:!0}),e.jsx("p",{className:"text-sm text-zinc-400",children:"Número da transação ativa"})]})});case"reset":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"type",children:"Tipo de Reset"}),e.jsxs(f,{value:o.type||"Hard",onValueChange:e=>m({...o,type:e}),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Selecione o tipo"})}),e.jsxs(C,{children:[e.jsx(I,{value:"Hard",children:"Hard (Reinicialização completa)"}),e.jsx(I,{value:"Soft",children:"Soft (Reinicialização leve)"})]})]}),e.jsx("p",{className:"text-sm text-zinc-400",children:"Hard: reinicia completamente. Soft: reinicia apenas o software"})]})});case"availability":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"connectorId",children:"ID do Conector"}),e.jsx(l,{id:"connectorId",type:"number",placeholder:"Ex: 1",value:o.connectorId||"1",onChange:e=>m({...o,connectorId:e.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"availabilityType",children:"Disponibilidade"}),e.jsxs(f,{value:o.type||"Operative",onValueChange:e=>m({...o,type:e}),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Selecione"})}),e.jsxs(C,{children:[e.jsx(I,{value:"Operative",children:"Operativo (Disponível)"}),e.jsx(I,{value:"Inoperative",children:"Inoperativo (Indisponível)"})]})]})]})]});case"unlock":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"connectorId",children:"ID do Conector"}),e.jsx(l,{id:"connectorId",type:"number",placeholder:"Ex: 1",value:o.connectorId||"1",onChange:e=>m({...o,connectorId:e.target.value}),required:!0}),e.jsx("p",{className:"text-sm text-zinc-400",children:"Número do conector a destravar"})]})});case"triggerMessage":return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"requestedMessage",children:"Mensagem OCPP"}),e.jsxs(f,{value:o.requestedMessage||"StatusNotification",onValueChange:e=>m({...o,requestedMessage:e}),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Selecione a mensagem"})}),e.jsxs(C,{children:[e.jsx(I,{value:"StatusNotification",children:"Status Notification"}),e.jsx(I,{value:"Heartbeat",children:"Heartbeat"}),e.jsx(I,{value:"MeterValues",children:"Meter Values"})]})]}),e.jsx("p",{className:"text-sm text-zinc-400",children:"Tipo de mensagem a ser disparada"})]})});default:return null}})()}),e.jsxs(v,{children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",className:"bg-emerald-500 hover:bg-emerald-600",children:"Executar"})]})]})})})},H=()=>{const[s,t]=a.useState([]),[l,g]=a.useState(!0),[j,u]=a.useState(!1),[b,N]=a.useState(null),[v,f]=a.useState(null),[w,y]=a.useState(!1),[C,I]=a.useState([]),[H,$]=a.useState(!1),V=a.useCallback(async()=>{try{const e=await d.get("/chargers");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json();t(a)}catch(e){}finally{g(!1)}},[]);a.useEffect(()=>{V();const e=setInterval(()=>{V()},5e3);return()=>clearInterval(e)},[V]);const L=[{id:"start",label:"Iniciar Transação",icon:e.jsx(R,{className:"w-5 h-5"}),description:"Iniciar sessão de carregamento remotamente",color:"text-emerald-400",bgColor:"bg-emerald-500/20"},{id:"stop",label:"Parar Transação",icon:e.jsx(z,{className:"w-5 h-5"}),description:"Interromper sessão ativa de carregamento",color:"text-red-400",bgColor:"bg-red-500/20"},{id:"reset",label:"Reset Carregador",icon:e.jsx(q,{className:"w-5 h-5"}),description:"Reiniciar sistema do carregador",color:"text-amber-400",bgColor:"bg-amber-500/20"},{id:"availability",label:"Disponibilidade",icon:e.jsx(x,{className:"w-5 h-5"}),description:"Alterar estado de disponibilidade",color:"text-blue-400",bgColor:"bg-blue-500/20"},{id:"unlock",label:"Destravar Conector",icon:e.jsx(M,{className:"w-5 h-5"}),description:"Liberar conector bloqueado",color:"text-purple-400",bgColor:"bg-purple-500/20"},{id:"triggerMessage",label:"Mensagem OCPP",icon:e.jsx(D,{className:"w-5 h-5"}),description:"Enviar mensagem OCPP específica",color:"text-orange-400",bgColor:"bg-orange-500/20"}],A=(e,a,s,r)=>{const t={id:Date.now().toString(),command:e,chargerId:a,timestamp:new Date,status:s,message:r};I(e=>[t,...e].slice(0,10))},W=async(e,a,s)=>{const r=a.chargerId;A(s,r,"pending");try{const t=await d.post(`/command/${e}`,a);if(!t.ok){const e=await t.json().catch(()=>({error:"Erro desconhecido"}));throw new Error(e.details||e.error||"Erro desconhecido")}await t.json(),A(s,r,"success","Comando executado com sucesso"),p.success(`Comando '${s}' enviado com sucesso!`)}catch(t){const e=t instanceof Error?t.message:"Erro desconhecido";A(s,r,"error",e),p.error(`ERRO: ${e}`)}},B=async(e,a,s,r)=>{A(r,s,"pending");try{const t=await d.post(`/chargers/${s}/${e}`,a);if(!t.ok){const e=await t.json().catch(()=>({error:"Erro desconhecido"}));throw new Error(e.details||e.error||"Erro desconhecido")}await t.json(),A(r,s,"success","Comando executado com sucesso"),p.success(`Comando '${r}' enviado com sucesso!`)}catch(t){const e=t instanceof Error?t.message:"Erro desconhecido";A(r,s,"error",e),p.error(`ERRO: ${e}`)}},Z=s.filter(e=>e.isConnected).length,G=s.filter(e=>!e.isConnected).length;return l?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-emerald-300/60",children:"Carregando carregadores..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-emerald-50 flex items-center gap-3",children:[e.jsx(P,{className:"w-8 h-8 text-emerald-400"}),"Centro de Operações"]}),e.jsx("p",{className:"text-emerald-300/60 mt-1",children:"Controle remoto dos carregadores OCPP"})]}),e.jsxs("button",{onClick:async()=>{u(!0),await V(),u(!1),p.success("Lista atualizada!")},disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-emerald-900/30 hover:bg-emerald-800/50 border border-emerald-800/30 rounded-lg text-emerald-300 transition-all",children:[e.jsx(c,{className:"w-4 h-4 "+(j?"animate-spin":"")}),"Atualizar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsxs(i,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-emerald-500/20 rounded-xl",children:e.jsx(k,{className:"w-6 h-6 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Carregadores Online"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:Z})]})]})}),e.jsx(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsxs(i,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-zinc-500/20 rounded-xl",children:e.jsx(S,{className:"w-6 h-6 text-zinc-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Carregadores Offline"}),e.jsx("p",{className:"text-2xl font-bold text-zinc-400",children:G})]})]})}),e.jsx(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30",children:e.jsxs(i,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:e.jsx(_,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Comandos Executados"}),e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:C.length})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30 backdrop-blur-sm shadow-2xl shadow-emerald-900/20",children:[e.jsxs(o,{className:"border-b border-emerald-800/30 pb-4",children:[e.jsxs(m,{className:"text-lg text-emerald-50 flex items-center gap-2",children:[e.jsx(x,{className:"w-5 h-5 text-emerald-400"}),"Comandos OCPP"]}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Selecione uma ação"})]}),e.jsx(i,{className:"space-y-2 pt-4",children:L.map(a=>{const s=b===a.id;return e.jsx("button",{onClick:()=>N(a.id),className:"w-full p-3 border rounded-xl transition-all text-left group "+(s?"bg-emerald-500/20 border-emerald-500 shadow-lg shadow-emerald-900/20":"bg-emerald-950/30 border-emerald-800/30 hover:border-emerald-700/50 hover:bg-emerald-900/30"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2.5 rounded-lg ${s?"bg-emerald-500/30":a.bgColor}`,children:e.jsx("div",{className:s?"text-emerald-300":a.color,children:a.icon})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate "+(s?"text-emerald-100":"text-emerald-50"),children:a.label}),e.jsx("p",{className:"text-xs truncate "+(s?"text-emerald-200/70":"text-emerald-300/50"),children:a.description})]}),e.jsx(E,{className:"w-4 h-4 transition-transform "+(s?"text-emerald-400 translate-x-1":"text-emerald-600 group-hover:translate-x-1")})]})},a.id)})})]}),e.jsxs(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30 backdrop-blur-sm shadow-2xl shadow-emerald-900/20",children:[e.jsxs(o,{className:"border-b border-emerald-800/30 pb-4",children:[e.jsxs(m,{className:"text-lg text-emerald-50 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-emerald-400"}),"Carregadores",e.jsxs("span",{className:"ml-auto text-sm font-normal text-emerald-300/60",children:[Z," online"]})]}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Selecione o destino"})]}),e.jsx(i,{className:"space-y-2 max-h-[400px] overflow-y-auto pt-4 custom-scrollbar",children:0===s.length?e.jsx("div",{className:"text-center py-8 text-emerald-300/50",children:"Nenhum carregador encontrado"}):s.map(a=>{const s=v?.charge_point_id===a.charge_point_id;return e.jsxs("button",{onClick:()=>f(a),className:"w-full p-3 border rounded-xl transition-all text-left "+(s?"bg-emerald-500/20 border-emerald-500 shadow-lg shadow-emerald-900/20":"bg-emerald-950/30 border-emerald-800/30 hover:border-emerald-700/50 hover:bg-emerald-900/30"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+(a.isConnected?"bg-emerald-400":"bg-zinc-500")}),a.isConnected&&e.jsx("div",{className:"absolute inset-0 w-3 h-3 rounded-full bg-emerald-400 animate-ping opacity-75"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate "+(s?"text-emerald-100":"text-emerald-50"),children:a.charge_point_id}),e.jsxs("p",{className:"text-xs truncate "+(s?"text-emerald-200/70":"text-emerald-300/50"),children:[a.address||"Sem endereço"," • ",a.potencia_kw||"?"," kW"]})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(a.isConnected?"bg-emerald-500/20 text-emerald-400":"bg-zinc-500/20 text-zinc-400"),children:a.isConnected?"Online":"Offline"})]}),s&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-emerald-700/30 grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-emerald-950/50",children:[e.jsx("p",{className:"text-emerald-300/50",children:"Energia Total"}),e.jsxs("p",{className:"text-emerald-200 font-medium",children:[parseFloat(a.total_kwh_charged.toString()).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-emerald-950/50",children:[e.jsx("p",{className:"text-emerald-300/50",children:"Lucro Total"}),e.jsxs("p",{className:"text-emerald-200 font-medium",children:["R$ ",parseFloat(a.total_profit.toString()).toFixed(2)]})]})]})]},a.charge_point_id)})})]}),e.jsxs(n,{className:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 border-emerald-800/30 backdrop-blur-sm shadow-2xl shadow-emerald-900/20",children:[e.jsxs(o,{className:"border-b border-emerald-800/30 pb-4",children:[e.jsxs(m,{className:"text-lg text-emerald-50 flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-emerald-400"}),"Histórico de Comandos"]}),e.jsx("p",{className:"text-sm text-emerald-300/60",children:"Últimos 10 comandos"})]}),e.jsx(i,{className:"space-y-2 max-h-[400px] overflow-y-auto pt-4 custom-scrollbar",children:0===C.length?e.jsxs("div",{className:"text-center py-8 text-emerald-300/50",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),e.jsx("p",{children:"Nenhum comando executado"})]}):C.map(a=>e.jsx("div",{className:"p-3 rounded-xl border "+("success"===a.status?"bg-emerald-500/10 border-emerald-500/30":"error"===a.status?"bg-red-500/10 border-red-500/30":"bg-amber-500/10 border-amber-500/30"),children:e.jsxs("div",{className:"flex items-start gap-2",children:["success"===a.status?e.jsx(T,{className:"w-4 h-4 text-emerald-400 mt-0.5"}):"error"===a.status?e.jsx(O,{className:"w-4 h-4 text-red-400 mt-0.5"}):e.jsx(h,{className:"w-4 h-4 text-amber-400 animate-pulse mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-emerald-100 truncate",children:a.command}),e.jsx("span",{className:"text-xs text-emerald-300/50 whitespace-nowrap",children:a.timestamp.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-xs text-emerald-300/60 truncate",children:a.chargerId}),a.message&&e.jsx("p",{className:"text-xs mt-1 "+("error"===a.status?"text-red-400/70":"text-emerald-300/50"),children:a.message})]})]})},a.id))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-emerald-950/50 to-transparent rounded-xl border border-emerald-800/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[b&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-500/20 rounded-lg border border-emerald-500/30",children:[e.jsx("span",{className:"text-sm text-emerald-300",children:"Comando:"}),e.jsx("span",{className:"text-sm font-medium text-emerald-100",children:L.find(e=>e.id===b)?.label})]}),v&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-500/20 rounded-lg border border-blue-500/30",children:[e.jsx("span",{className:"text-sm text-blue-300",children:"Destino:"}),e.jsx("span",{className:"text-sm font-medium text-blue-100",children:v.charge_point_id})]}),!b&&!v&&e.jsx("p",{className:"text-emerald-300/50 text-sm",children:"Selecione um comando e um carregador para continuar"})]}),e.jsx(r,{size:"lg",onClick:()=>{b&&v?y(!0):p.error("Selecione um comando e um carregador")},disabled:!b||!v||H,className:"bg-emerald-600 hover:bg-emerald-500 text-white disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-900/30 min-w-[180px]",children:H?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}),"Executando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Executar Comando"]})})]}),b&&v&&e.jsx(F,{open:w,onOpenChange:y,commandType:b,chargerName:v.charge_point_id,onConfirm:async e=>{if(!b||!v)return;$(!0);const a=v,s=L.find(e=>e.id===b),r=s?.label||b;"start"===b?await W("start",{chargerId:a.charge_point_id,idTag:e.idTag},r):"stop"===b?await W("stop",{chargerId:a.charge_point_id,transactionId:e.transactionId},r):"reset"===b?await B("reset",{type:e.type},a.charge_point_id,r):"availability"===b?await B("availability",{connectorId:e.connectorId,type:e.type},a.charge_point_id,r):"unlock"===b?await B("unlock",{connectorId:e.connectorId},a.charge_point_id,r):"triggerMessage"===b&&await B("trigger-message",{requestedMessage:e.requestedMessage},a.charge_point_id,r),$(!1),N(null),f(null)}})]})};export{H as Operations};
